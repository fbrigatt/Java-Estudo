package com.xti.jdbc.NOVO;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.xti.jdbc.ConnectionFactory;

public class ContaCRUD {

	public void salvar(Connection con, Conta conta) throws SQLException {
		String sql = "insert into conta values(?, ?, ?);";

		try (PreparedStatement stmt = con.prepareStatement(sql)) {

			stmt.setInt(1, conta.numero);
			stmt.setString(2, conta.nome);
			stmt.setDouble(3, conta.saldo);
			stmt.execute();

			System.out.println("Salvo com Sucesso");
		}
	}

	public void alterar(Connection con, Conta conta) throws SQLException {
		String sql = "update conta set cliente=?, saldo=? where numero=?;";

		try (PreparedStatement stmt = con.prepareStatement(sql)) {

			stmt.setString(1, conta.nome);
			stmt.setDouble(2, conta.saldo);
			stmt.setInt(3, conta.numero);
			int row = stmt.executeUpdate();

			System.out.println("Alterado com Sucesso: " + row + " linhas");
		}
	}

	public void excluir(Connection con, Conta conta) throws SQLException {
		String sql = "delete from conta where numero=?;";

		try (PreparedStatement stmt = con.prepareStatement(sql)) {

			stmt.setInt(1, conta.numero);
			int row = stmt.executeUpdate();

			System.out.println("Deletado com Sucesso: " + row + " linhas");
		}
	}

	public List<Conta> listar(Connection con) throws SQLException {
		List<Conta> lista = new ArrayList<>();
		String sql = "select numero, cliente, saldo from conta";
		try (PreparedStatement stmt = con.prepareStatement(sql); ResultSet rs = stmt.executeQuery()) {
			while (rs.next()) {
				lista.add(new Conta(rs.getInt(1), rs.getString(2), rs.getDouble(3)));
			}
		}
		return lista;
	}

	public static void main(String[] args) throws SQLException {
		Connection con = ConnectionFactory.getConnection();

		ContaCRUD crud = new ContaCRUD();

		Conta c1 = new Conta(1, "Raphael", 1000);
		Conta c2 = new Conta(2, "Silva", 2000);
		Conta c3 = new Conta(3, "Oliveira", 3000);

		// crud.salvar(con, c1);
		// crud.salvar(con, c2);
		// crud.salvar(con, c3);

		// c1.saldo = 39;
		// crud.alterar(con, c1);

		crud.excluir(con, c1);

		List<Conta> contas = crud.listar(con);
		for (Conta conta : contas) {
			System.out.println(conta);
		}
	}
}
